{% extends "base.html" %}
{% block content %}
<section class="card">
  <h2>Scheduled Drills</h2>
  <p class="hint">
    Drills scheduled here will automatically fire at the specified time (server time).
    This is a simple one-shot scheduler (each drill runs once).
  </p>

  <h3>Create New Drill</h3>
  <form method="POST" action="{{ url_for('admin_drills_post') }}" class="form-grid">
    <input type="hidden" name="op" value="create">
    <label>Label
      <input type="text" name="label" placeholder="e.g. Monthly Evac Drill">
    </label>
    <label>Mode
      <select name="mode">
        <option value="DRILL">DRILL</option>
        <option value="LIVE">LIVE</option>
      </select>
    </label>
    <label>Action
      <select name="action">
        <option value="HOLD">HOLD</option>
        <option value="SECURE">SECURE</option>
        <option value="LOCKDOWN">LOCKDOWN</option>
        <option value="SHELTER">SHELTER</option>
        <option value="EVACUATE">EVACUATE</option>
      </select>
    </label>
    <label>Zone
      <input type="text" name="zone" placeholder="ALL or custom zone name">
    </label>
    <label>Run At (server time)
      <input type="datetime-local" name="run_at">
    </label>
    <label style="margin-top: 8px;">
      <input type="checkbox" name="enabled" checked> Enabled
    </label>
    <div style="grid-column: 1 / -1; margin-top: 10px;">
      <button type="submit" class="btn lockdown">Create Scheduled Drill</button>
    </div>
  </form>
</section>

<section class="card">
  <h3>Existing Drills</h3>
  <table class="simple">
    <thead>
      <tr>
        <th>ID</th>
        <th>Label</th>
        <th>Mode</th>
        <th>Action</th>
        <th>Zone</th>
        <th>Run At</th>
        <th>Enabled</th>
        <th>Last Run</th>
        <th>Delete</th>
      </tr>
    </thead>
    <tbody>
      {% for d in drills %}
      <tr>
        <td>{{ d.id }}</td>
        <td>{{ d.label }}</td>
        <td>{{ d.mode }}</td>
        <td>{{ d.action }}</td>
        <td>{{ d.zone }}</td>
        <td>{% if d.run_at %}{{ d.run_at|datetimeformat }}{% else %}&mdash;{% endif %}</td>
        <td>{{ 'yes' if d.enabled else 'no' }}</td>
        <td>{% if d.last_run_at %}{{ d.last_run_at|datetimeformat }}{% else %}&mdash;{% endif %}</td>
        <td>
          <form method="POST" action="{{ url_for('admin_drills_post') }}">
            <input type="hidden" name="op" value="delete">
            <input type="hidden" name="id" value="{{ d.id }}">
            <button type="submit" class="btn danger" style="font-size: 11px; padding: 2px 6px;">Delete</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
